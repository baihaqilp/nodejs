node {
   def commit_id
   stages {
   stage('Preparation') {
     checkout scm
     sh "git rev-parse --short HEAD > .git/commit-id"                        
     commit_id = readFile('.git/commit-id').trim()
   }
}
}
pipeline {
    agent { dockerfile true }
    stages {
        stage('Test') {
            steps {
                sh 'docker build -t mraagil/docker-nodejs .'
                sh 'docker run -P -d mraagil/docker-nodejs'
            }
        }
    }
}